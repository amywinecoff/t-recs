

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>models.popularity &mdash; Algo-segregation 0.1.0b documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Algo-segregation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/reference.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Algo-segregation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>models.popularity</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for models.popularity</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">rec.models</span> <span class="kn">import</span> <span class="n">BaseRecommender</span>
<span class="kn">from</span> <span class="nn">rec.metrics</span> <span class="kn">import</span> <span class="n">MSEMeasurement</span>
<span class="kn">from</span> <span class="nn">rec.utils</span> <span class="kn">import</span> <span class="n">get_first_valid</span><span class="p">,</span> <span class="n">is_array_valid_or_none</span><span class="p">,</span> <span class="n">is_equal_dim_or_none</span><span class="p">,</span> <span class="n">all_none</span><span class="p">,</span> <span class="n">is_valid_or_none</span>

<div class="viewcode-block" id="PopularityRecommender"><a class="viewcode-back" href="../../reference/models.html#models.popularity.PopularityRecommender">[docs]</a><span class="k">class</span> <span class="nc">PopularityRecommender</span><span class="p">(</span><span class="n">BaseRecommender</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A customizable popularity recommendation system.</span>

<span class="sd">    With the popularity recommender system, users are presented items that are popular in the system. The popularity of an item is measured by the number of times users interacted with that item in the past. In this implementation, items do not expire and, therefore, the system does not base its choice on how recent the items are.</span>

<span class="sd">    Item attributes are represented by a `1x|I|` array, where `|I|` is the number of items in the system. This array stores the number of user interactions for each item.</span>

<span class="sd">    User profiles are represented by a `|U|x1` matrix, where `|U|` is the number of users in the system. All elements of this matrix are equal to 1, as the predictions of the system are solely based on the item attributes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>

<span class="sd">        num_users: int (optional, default: 100)</span>
<span class="sd">            The number of users `|U|` in the system.</span>

<span class="sd">        num_items: int (optional, default: 1250)</span>
<span class="sd">            The number of items `|I|` in the system.</span>

<span class="sd">        item_representation: :obj:`numpy.ndarray` or None (optional, default: None)</span>
<span class="sd">            A `|A|x|I|` matrix representing the similarity between each item and attribute. If this is not None, num_items is ignored.</span>

<span class="sd">        user_representation: :obj:`numpy.ndarray` or None (optional, default: None)</span>
<span class="sd">            A `|U|x|A|` matrix representing the similarity between each item and attribute, as interpreted by the system. If this is not None, num_users is ignored.</span>

<span class="sd">        actual_user_representation: :obj:`numpy.ndarray` or None (optional, default: None)</span>
<span class="sd">            A `|U|x|I|` matrix representing the real user scores. This matrix is **not** used for recommendations. This is only kept for measurements and the system is unaware of it.</span>

<span class="sd">        verbose: bool (optional, default: False)</span>
<span class="sd">            If True, enables verbose mode. Disabled by default.</span>

<span class="sd">        num_items_per_iter: int (optional, default: 10)</span>
<span class="sd">            Number of items presented to the user per iteration.</span>

<span class="sd">        seed: int, None (optional, default: None)</span>
<span class="sd">            Seed for random generator.</span>

<span class="sd">    Attributes</span>
<span class="sd">    -----------</span>
<span class="sd">        Inherited by BaseRecommender: :class:`~models.recommender.BaseRecommender`</span>

<span class="sd">    Examples</span>
<span class="sd">    ---------</span>
<span class="sd">        PopularityRecommender can be instantiated with no arguments -- in which case, it will be initialized with the default parameters.</span>

<span class="sd">        &gt;&gt;&gt; pr = PopularityRecommender()</span>
<span class="sd">        &gt;&gt;&gt; pr.user_profiles.shape</span>
<span class="sd">        (100, 1)   # &lt;-- 100 users (default)</span>
<span class="sd">        &gt;&gt;&gt; pr.item_attributes.shape</span>
<span class="sd">        (1, 1250) # &lt;-- 1250 items (default)</span>

<span class="sd">        This class can be customized by defining the number of users and/or items</span>
<span class="sd">        in the system.</span>

<span class="sd">        &gt;&gt;&gt; pr = PopularityRecommender(num_users=1200, num_items=5000)</span>
<span class="sd">        &gt;&gt;&gt; pr.user_profiles.shape</span>
<span class="sd">        (1200, 1) # &lt;-- 1200 users</span>
<span class="sd">        &gt;&gt;&gt; cf.item_attributes.shape</span>
<span class="sd">        (1, 5000)</span>

<span class="sd">        Or by generating representations for items (user representation can also be defined, but they should always be set to all ones). In the example below, items are uniformly distributed and have had between 0 and 10 interactions each.</span>

<span class="sd">            &gt;&gt;&gt; item_representation = np.random.randint(11, size=(1, 200))</span>
<span class="sd">            &gt;&gt;&gt; pr = PopularityRecommender(item_representation=item_representation)</span>
<span class="sd">            &gt;&gt;&gt; cf.item_attributes.shape</span>
<span class="sd">            (1, 200)</span>
<span class="sd">            &gt;&gt;&gt; cf.user_profiles.shape</span>
<span class="sd">            (100, 1)</span>

<span class="sd">        Note that user and item representations have the precedence over the number of</span>
<span class="sd">        users and the number of items specified at initialization. For example:</span>

<span class="sd">        &gt;&gt;&gt; user_representation = np.ones((3000, 1))</span>
<span class="sd">        &gt;&gt;&gt; pr = PopularityRecommender(num_users=50, user_representation=user_representation)</span>
<span class="sd">        &gt;&gt;&gt; pr.user_profiles.shape</span>
<span class="sd">        (3000, 1) # &lt;-- 30000 users. num_users was ignored because user_representation was specified.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_users</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">num_items</span><span class="o">=</span><span class="mi">1250</span><span class="p">,</span>
                 <span class="n">item_representation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_representation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">actual_user_representation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_items_per_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">all_none</span><span class="p">(</span><span class="n">item_representation</span><span class="p">,</span> <span class="n">num_items</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_items and item_representation can&#39;t be all None&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">all_none</span><span class="p">(</span><span class="n">user_representation</span><span class="p">,</span> <span class="n">num_users</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_users and user_representation can&#39;t be all None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_array_valid_or_none</span><span class="p">(</span><span class="n">item_representation</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;item_representation is not valid&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_array_valid_or_none</span><span class="p">(</span><span class="n">user_representation</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;item_representation is not valid&quot;</span><span class="p">)</span>

        <span class="n">num_items</span> <span class="o">=</span> <span class="n">get_first_valid</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">item_representation</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">,</span>
                                            <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">num_items</span><span class="p">)</span>

        <span class="n">num_users</span> <span class="o">=</span> <span class="n">get_first_valid</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">user_representation</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">num_users</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">item_representation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">item_representation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_items</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_representation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">user_representation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_users</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_equal_dim_or_none</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">user_representation</span><span class="p">,</span>
                                            <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="nb">getattr</span><span class="p">(</span><span class="n">item_representation</span><span class="p">,</span>
                                            <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;user_representation.shape[1] should be the same as &quot;</span> <span class="o">+</span> \
                             <span class="s2">&quot;item_representation.shape[0]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_equal_dim_or_none</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">user_representation</span><span class="p">,</span>
                                            <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">num_users</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;user_representation.shape[0] should be the same as &quot;</span> <span class="o">+</span> \
                             <span class="s2">&quot;num_users&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_equal_dim_or_none</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">item_representation</span><span class="p">,</span>
                                            <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">num_items</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;item_representation.shape[1] should be the same as &quot;</span> <span class="o">+</span> \
                             <span class="s2">&quot;num_items&quot;</span><span class="p">)</span>

        <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span><span class="n">MSEMeasurement</span><span class="p">()]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">user_representation</span><span class="p">,</span> <span class="n">item_representation</span><span class="p">,</span>
                         <span class="n">actual_user_representation</span><span class="p">,</span> <span class="n">num_users</span><span class="p">,</span> <span class="n">num_items</span><span class="p">,</span>
                         <span class="n">num_items_per_iter</span><span class="p">,</span>
                         <span class="n">measurements</span><span class="o">=</span><span class="n">measurements</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_user_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interactions</span><span class="p">):</span>
        <span class="n">histogram</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">histogram</span><span class="p">,</span> <span class="n">interactions</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_attributes</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_attributes</span><span class="p">,</span> <span class="n">histogram</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Elena Lucherini

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>